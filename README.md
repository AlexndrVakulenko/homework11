Домашнее задание по теме "Bach"

Задание:
Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.
Необходимая информация в письме:
- Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
- Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
- Ошибки веб-сервера/приложения c момента последнего запуска;
- Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
- Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.


Реализация:
Скрипт script.sh обрабатывает файл nginx_log.log; результаты направляются в result.txt, который затем отправляется на почту. Предотвращение мультизапуска с помощью утилиты flock.

Файл /etc/crontab
0 * 1 * * *  flock -xn /var/lock/script.lock -c 'sh /root/script.sh'

Вместе с запуском скрипта, создаётся .lock файл, который остаётся заблокирован, пока скрипт будет работать. Как только скрипт завершает свою работу, блокировка с файла снимается, и новый процесс может быть вновь запущен в системе
